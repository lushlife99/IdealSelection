<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>mySelectionPage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .pagination {
            display: flex;
            list-style: none;
            padding: 0;
        }

        .pagination li {
            margin: 0 5px;
        }

        .pagination a {
            text-decoration: none;
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
            color: #333;
        }

        .pagination .active {
            background-color: #007BFF;
            color: #fff;
        }

        .row.equal > [class*='col-'] {
            display: flex;
            flex-direction: column;
        }

        .row.equal {
            display: flex;
            flex-wrap: wrap;
        }

        .row.equal [class*='col-'] > .ibox-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .row.equal .product-imitation {
            flex: 1;
        }

        .row.equal .product-desc {
            flex: 1;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-light mb-3">
    <div class="container-fluid">
        <!-- Navigation links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/main">이상형 월드컵</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/create">이상형 월드컵 만들기</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/mySelection">내 월드컵 관리</a>
            </li>
        </ul>

        <!-- Logout button -->
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="logout()">로그아웃</a>
            </li>
        </ul>
    </div>
</nav>

<div id="content" class="row equal">
    <!-- Content will be dynamically updated here -->
</div>

<ul class="pagination mt-5" id="pagination" th:with="num=(${selectionList.size() % 10 == 0} ? ${selectionList.size() / 10} : ${selectionList.size() / 10 + 1})">
    <li th:if="${pagePrefix != 0}">
        <a href="#" onclick="changePage('prev')">이전</a>
    </li>
    <li th:each="i : ${#numbers.sequence(1, num)}">
        <a href="#" th:attr="onclick='changePage(' + ${i} + ')'" th:text="(${pagePrefix} + ${i})">0</a>
    </li>
    <li th:if="${selectionList.size() == 100}">
        <a href="#" onclick="changePage('next')">다음</a>
    </li>
</ul>

<script th:inline="javascript">
    var selectionList = [[ ${selectionList} ]];
    var currentPage = 1;
    var itemsPerPage = 10;

    function changePage(page) {
        if (page === 'prev') {
            getPrevPaginationList();
        } else if (page === 'next') {
            getNextPaginationList();
        } else if (typeof page === 'number') {
            console.log(page);
            currentPage = page;
        }

        // Update the active state of the pagination buttons.
        updatePagination();
        updateContent();
    }

    function updateContent() {
        var startIdx = (currentPage - 1) * itemsPerPage;
        var endIdx = startIdx + itemsPerPage;

        var contentDiv = document.getElementById('content');
        contentDiv.innerHTML = '';

        var rowDiv;
        for (var i = startIdx; i < endIdx && i < selectionList.length; i++) {
            var selection = selectionList[i];

            if (i % 5 === 0) {
                rowDiv = document.createElement('div');
                rowDiv.className = 'row equal';
            }

            // Create HTML elements dynamically
            var colDiv = document.createElement('div');
            colDiv.className = 'col-xs-6 col-sm-3 col-lg-2';

            var iboxContentDiv = document.createElement('div');
            iboxContentDiv.className = 'ibox-content product-box';

            var productImitationDiv = document.createElement('div');
            productImitationDiv.className = 'product-imitation';
            productImitationDiv.style = 'height: 200px; padding: 0px;';

            // Background images
            var img1Div = document.createElement('div');
            img1Div.style = 'float: left; width: 50%; height: 180px; background-image: url(\'' + selection.img1 + '\'); background-repeat: no-repeat; background-size: cover; background-position: center top; display: flex;';

            var img2Div = document.createElement('div');
            img2Div.style = 'width: 50%; height: 180px; background-image: url(\'' + selection.img2 + '\'); background-repeat: no-repeat; background-size: cover; background-position: center top; display: flex;';

            productImitationDiv.appendChild(img1Div);
            productImitationDiv.appendChild(img2Div);

            var productDescDiv = document.createElement('div');
            productDescDiv.className = 'product-desc';
            productDescDiv.style = 'cursor: pointer';
            productDescDiv.setAttribute('data-id', selection.id);

            // Other elements
            var productNameAnchor = document.createElement('a');
            productNameAnchor.className = 'product-name';
            productNameAnchor.href = '#';
            productNameAnchor.innerHTML = selection.title;

            var smallDiv = document.createElement('div');
            smallDiv.className = 'small m-t-xs';
            smallDiv.innerHTML = selection.body;

            // Edit and delete buttons
            var btnGroupDiv = document.createElement('div');
            btnGroupDiv.className = 'btn-group';
            btnGroupDiv.setAttribute('data-id', selection.id);

            var editButton = document.createElement('button');
            editButton.type = 'button';
            editButton.className = 'btn btn-sm btn-outline btn-info fedit';
            editButton.innerHTML = '<i class="fa fa-edit"></i> 수정';

            var deleteButton = document.createElement('button');
            deleteButton.type = 'button';
            deleteButton.className = 'btn btn-sm btn-outline btn-primary fdelete';
            deleteButton.innerHTML = '<i class="fa fa-trash"></i> 삭제';

            btnGroupDiv.appendChild(editButton);
            btnGroupDiv.appendChild(deleteButton);

            // Append everything to the container div
            productDescDiv.appendChild(productNameAnchor);
            productDescDiv.appendChild(smallDiv);
            productDescDiv.appendChild(btnGroupDiv);

            iboxContentDiv.appendChild(productImitationDiv);
            iboxContentDiv.appendChild(productDescDiv);
            colDiv.appendChild(iboxContentDiv);

            rowDiv.appendChild(colDiv);
            contentDiv.appendChild(rowDiv);
        }
    }


    function getNextPaginationList() {
        console.log("next");
        window.location.href = '/mySelection?pagePrefix=' + (parseInt([[${pagePrefix}]]) + 10);
    }

    function getPrevPaginationList() {
        console.log("prev");
        window.location.href = '/mySelection?pagePrefix=' + (parseInt([[${pagePrefix}]]) - 10);
    }

    function updatePagination() {
        var paginationLinks = document.querySelectorAll('.pagination a');
        paginationLinks.forEach(function (link) {
            link.classList.remove('active');
            if (link.innerHTML == currentPage) {
                link.classList.add('active');
            }
        });
    }

    function logout() {
        $.ajax({
            type: 'GET',
            url: '/api/logOut',
            success: function (response) {
                alert("로그아웃");
                window.location.href = '/login';
            },
            error: function (error) {
                alert(error.responseJSON.message);
            }
        });
    }

    function changeSelection() {
        // Implement if needed
    }

    function sortByPopularity() {
        alert("인기순으로 정렬합니다.");
    }

    function sortByLatest() {
        alert("최신순으로 정렬합니다.");
    }

    function search() {
        alert("검색 기능 구현");
    }

    changePage(1);
</script>
</body>
</html>
