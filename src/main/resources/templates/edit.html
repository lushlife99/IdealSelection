<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>editPage</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-light mb-3">
  <div class="container-fluid">
    <!-- Navigation links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/main">이상형 월드컵</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/create">이상형 월드컵 만들기</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/mySelection">내 월드컵 관리</a>
      </li>
    </ul>

    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="logout()">로그아웃</a>
      </li>
    </ul>
  </div>
</nav>

<table>
  <thead>
  <tr>
    <th>번호</th>
    <th>이미지</th>
    <th>이름 변경</th>
    <th>이미지 변경</th>
    <th>이상형 삭제</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="ideal, index : ${selection.getIdealList()}">
    <td th:text="${index.count}"></td>
    <td>
      <img th:src="'/api/selection/image/' + ${selection.filePath} + '/' + ${ideal.idealName}" alt="이미지" style="max-width: 120px; max-height: 200px;">
    </td>
    <td>
      <input type="text" th:value="${ideal.idealName}" id="idealNameInput"
             onkeypress="handleKeyPress(event, ${ideal.id})">
    </td>
    <td>
      <input type="file" />
    </td>
    <td>
      <button th:attr="data-id=${ideal.id}" class="delete-btn">이상형 삭제</button>
    </td>
  </tr>
  </tbody>
</table>

</body>
</html>

<script th:inline="javascript">

  function handleKeyPress(event, idealId) {
    if (event.key === 'Enter') {
      var inputValue = document.getElementById('idealNameInput').value;

      // 여기서 Ajax 요청을 보내도록 수정
      $.ajax({
        url: '/your-ajax-endpoint', // 실제 엔드포인트로 변경
        type: 'POST', // 또는 'GET' 등
        data: {
          idealId: idealId,
          newValue: inputValue
        },
        success: function(response) {
          // 성공 시 처리
          console.log('Ajax 요청 성공', response);
        },
        error: function(error) {
          // 실패 시 처리
          console.error('Ajax 요청 실패', error);
        }
      });
    }
  }

  function logout() {
    $.ajax({
      type: 'GET',
      url: '/api/logOut',  // 실제 로그인 엔드포인트로 변경
      success: function (response) {
        alert("로그아웃");
        window.location.href = '/login';
      },
      error: function (error) {
        alert(error.responseJSON.message);
      }
    });
  }


</script>