<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>editPage</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-light mb-3">
  <div class="container-fluid">
    <!-- Navigation links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/main">이상형 월드컵</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/create">이상형 월드컵 만들기</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/mySelection">내 월드컵 관리</a>
      </li>
    </ul>

    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="logout()">로그아웃</a>
      </li>
    </ul>
  </div>
</nav>

<table>
  <thead>
  <tr>
    <th>번호</th>
    <th>이미지</th>
    <th>이름 변경</th>
    <th>이미지 변경</th>
    <th>이상형 삭제</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="ideal, index : ${selection.getIdealList()}">
    <td th:text="${index.count}"></td>
    <td>
      <img th:src="'/api/selection/image/' + ${selection.filePath} + '/' + ${ideal.idealName}" alt="이미지" style="max-width: 120px; max-height: 200px;">
    </td>
    <td>
      <input type="text" th:attr="data-id=${ideal.id}" th:value="${ideal.idealName}" class="idealNameInput">

    </td>
    <td>
      <input type="file" />
    </td>
    <td>
      <button th:attr="data-id=${ideal.id}" class="delete-btn">이상형 삭제</button>
    </td>
  </tr>
  </tbody>
</table>

</body>
</html>

<script th:inline="javascript">

  var idealInputs = document.getElementsByClassName('idealNameInput');
  console.log(idealInputs.length);
  for (var i = 0; i < idealInputs.length; i++) {
    idealInputs[i].addEventListener('keydown', function(event) {
      handleKeyPress(event, event.target.getAttribute('data-id'));
    });
  }
  function handleKeyPress(event, idealId) {
    console.log(event.target.value);
    if (event.key === 'Enter') {

      $.ajax({
        url: '/api/ideal/' + encodeURIComponent([[${selection.filePath}]]), // 실제 엔드포인트로 변경
        type: 'PUT',
        headers: {
        'Content-Type': 'application/json',
        },
        data: JSON.stringify({
          id: idealId,
          idealName: event.target.value,
        }),
        success: function(response) {
          console.log('Ajax 요청 성공', response);
        },
        error: function(error) {
          console.error('Ajax 요청 실패', error);
        }
      });
    }
  }

  function logout() {
    $.ajax({
      type: 'GET',
      url: '/api/logOut',  // 실제 로그인 엔드포인트로 변경
      success: function (response) {
        alert("로그아웃");
        window.location.href = '/login';
      },
      error: function (error) {
        alert(error.responseJSON.message);
      }
    });
  }


</script>